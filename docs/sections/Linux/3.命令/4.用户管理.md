## 一、基本概念

- **用户** 是 Linux 系统工作中重要的一环，用户管理包括 **用户** 与 **组** 管理
- 在 Linux 系统中，不论是由本机或是远程登录系统，每个系统都**必须拥有一个账号**，并且**对于不同的系统资源拥有不同的使用权限**
- 在 Linux 中，可以指定**每一个用户**针对 **不同的文件或者目录** 的 **不同权限**
- 对 **文件／目录** 的权限包括：

| 序号 | 权限 |  英文  | 缩写 | 数字代号 |
| :--: | :--: | :----: | :--: | :------: |
|  01  |  读  |  read  |  r   |    4     |
|  02  |  写  | write  |  w   |    2     |
|  03  | 执行 | excute |  x   |    1     |

**组**

- 为了方便用户管理，提出了组的概念，如下图所示

- 在实际应用中，可以预先针对组设置好权限，然后将不同的用户添加到对应的组中，从而不用依次为每一个用户设置权限



## 二、chmod 命令说明

- `chmod` 可以修改 **用户／组** 对 **文件／目录** 的权限
- 命令格式如下：

```bash
chmod +/-rwx 文件名|目录名
```

> 提示：以上方式会一次性修改 `拥有者` / `组` 权限

chmod修改文件权限有两种方式:

- 字母法
- 数字法

chmod修改文件权限有两种方式:

- 字母法
- 数字法

### 1. chmod 字母法的使用

**角色说明:**

| 角色 | 说明                     |
| :--- | :----------------------- |
| u    | user, 表示该文件的所有者 |
| g    | group, 表示用户组        |
| o    | other, 表示其他用户      |
| a    | all, 表示所有用户        |

**权限设置说明:**

| 操作符 | 说明     |
| :----- | :------- |
| +      | 增加权限 |
| -      | 撤销权限 |
| =      | 设置权限 |

**权限说明:**

| 权限 | 说明                                                         |
| :--- | :----------------------------------------------------------- |
| r    | read 表示可读取，对于一个目录，如果没有r权限，那么就意味着不能通过ls查看这个目录的内容。 |
| w    | write 表示可写入，对于一个目录，如果没有w权限，那么就意味着不能在目录下创建新的文件。 |
| x    | excute 表示可执行，对于一个目录，如果没有x权限，那么就意味着不能通过cd进入这个目录。 |
| -    | 无任何权限                                                   |



### 2. chmod 数字法的使用

数字法就是“rwx” 这些权限也可以用**数字来代替**

**权限说明:**

| 权限 | 说明                  |
| :--- | :-------------------- |
| r    | 可读，权限值是4       |
| w    | 可写，权限值是2       |
| x    | 可执行，权限值是1     |
| -    | 无任何权限，权限值是0 |



## 三、sudo 命令说明

| 令      | 说明                                                       |
| :------ | :--------------------------------------------------------- |
| sudo -s | 切换到root用户，获取管理员权限                             |
| sudo    | 某个命令的执行需要获取管理员权限可以在执行命令前面加上sudo |

- Linux 系统中的 `root` 账号通常用于系统的维护和管理，对操作系统的所有资源具有所有访问权限
- 在大多数版本的 Linux 中，都不推荐直接使用 root 账号登录系统
- 在 Linux 安装的过程中，系统会自动创建一个用户账号，而这个默认的用户就称为“标准用户”

- `su` 是 `substitute user` 的缩写，表示使用另一个用户的身份
- `sudo` 命令用来以其他身份来执行命令，预设的身份为 `root`
- 用户使用 `sudo` 时，必须先输入密码，之后有5 分钟的有效期限，超过期限则必须重新输入密码

> 若其未经授权的用户企图使用 `sudo`，则会发出警告邮件给管理员

**说明:**

- 如果只是某次操作需要使用管理员权限建议使用 sudo , 也就是说临时使用管理器权限。
- 如果大量操作都需要使用管理员权限 sudo –s, 但是操作需谨慎。



## 四、组管理命令说明

> 提示：**创建组** / **删除组** 的终端命令都需要通过 `sudo` 执行

| 序号 |           命令            |           作用            |
| :--: | :-----------------------: | :-----------------------: |
|  01  |       groupadd 组名       |          添加组           |
|  02  |       groupdel 组名       |          删除组           |
|  03  |      cat /etc/group       |        确认组信息         |
|  04  | chgrp -R 组名 文件/目录名 | 递归修改文件/目录的所属组 |

> 提示：
>
> - 组信息保存在 `/etc/group` 文件中
> - `/etc` 目录是专门用来保存系统配置信息的目录

- 在实际应用中，可以预先针对组设置好权限，然后将不同的用户添加到对应的组中，从而不用依次为每一个用户设置权限

**1. 创建用户组**

| 命令     | 说明             |
| :------- | :--------------- |
| groupadd | 创建(添加)用户组 |



**2. 创建用户并指定用户组**



**3. 修改用户组**

**4. 删除用户组**

| 命令     | 说明       |
| :------- | :--------- |
| groupdel | 删除用户组 |

**说明:**

- 如果用户组下面有用户先删除用户在删除用户组

## 五、用户管理命令说明

> 提示：**创建用户** / **删除用户** / **修改其他用户密码** 的终端命令都需要通过 `sudo` 执行

### 1. 创建用户／设置密码／删除用户

| 序号 |              命令              |     作用     |                             说明                             |
| :--: | :----------------------------: | :----------: | :----------------------------------------------------------: |
|  01  |  useradd -m -g 组 新建用户名   |  添加新用户  | -m 自动建立用户家目录-g 指定用户所在的组，否则会建立一个和同名的组 |
|  02  |         passwd 用户名          | 设置用户密码 |     如果是普通用户，直接用 passwd 可以修改自己的账户密码     |
|  03  |       userdel -r 用户名        |   删除用户   |                 -r 选项会自动删除用户家目录                  |
|  04  | cat /etc/passwd \| grep 用户名 | 确认用户信息 |       新建用户后，用户信息会保存在 /etc/passwd 文件中        |

> 提示：
>
> - 创建用户时，如果忘记添加 `-m` 选项指定新用户的家目录 —— 最简单的方法就是删除用户，重新创建
> - 创建用户时，默认会创建一个和用户名同名的组名
> - 用户信息保存在 `/etc/passwd` 文件中

**1. 创建用户**

| 命令    | 说明           |
| :------ | :------------- |
| useradd | 创建(添加)用户 |

**useradd命令选项:**

| 选项 | 说明                                                       |
| :--- | :--------------------------------------------------------- |
| -m   | 自动创建用户主目录,主目录的名字就是用户名                  |
| -g   | 指定用户所属的用户组，默认不指定会自动创建一个同名的用户组 |



**说明:**

- **useradd** 命令的使用需要使用管理员权限，前面需要加上 **sudo**
- 创建用户如果不指定用户组，默认会自动创建一个同名的用户组
- 查看用户是否创建成功，可以查看**/etc/passwd**这个文件
- 查看用户组是否创建成功，可以查看**/etc/group**这个文件

**passwd文件中的每项信息说明,以root:x：0:0:root:/root:/bin/bash为例:**

- 第一个：用户名
- 第二个：密码占位符
- 第三个：uid, 用户id
- 第四个：gid, 用户所在组id
- 第五个：用户描述, 可选，
- 第六个：用户的主目录所在位置
- 第七个：用户所用 shell 的类型，一般由bash或者sh，默认不设置是sh类型

**group文件中的每项信息说明, 以laowang:x:1001:为例:**

- 第一个：用户组名
- 第二个：用户组密码占位符，一般Linux系统的用户组都没有密码的
- 第三个：组id

**id命令查看用户信息:**

| 命令 | 说明         |
| :--- | :----------- |
| id   | 查看用户信息 |



**每项信息说明:**

uid=1001(laowang) gid=1001(laowang) 组=1001(laowang)

- 第一个: uid 表示用户id
- 第二个: gid 表示用户组id
- 第三个: 组 表示用户所在的用户组

**2. 设置密码**

给其它用户设置密码，需要使用: **sudo passwd 用户名**

**3. 切换用户**

| 命令 | 说明     |
| :--- | :------- |
| su   | 切换用户 |

**语法格式: su - 用户名**

**4. 修改用户信息**

| 命令    | 说明         |
| :------ | :----------- |
| usermod | 修改用户信息 |

**usermod选项:**

| 命令 | 说明           |
| :--- | :------------- |
| -G   | 设置一个附加组 |
| -g   | 修改用户组     |



**5. 扩展: 删除附加组**

| 命令    | 说明                 |
| :------ | :------------------- |
| gpasswd | 添加和删除附加组信息 |

**gpasswd命令选项:**

| 选项      | 说明             |
| :-------- | :--------------- |
| -a 用户名 | 给用户添加附加组 |
| -d 用户名 | 给用户删除附加组 |



**5. 删除用户**

| 命令    | 说明     |
| :------ | :------- |
| userdel | 删除用户 |

**userdel命令选项:**

| 选项      | 说明                                               |
| :-------- | :------------------------------------------------- |
| -r 用户名 | 删除用户主目录，必须要设置，否则用户主目录不会删除 |



**说明:**

- 删除用户，默认同名的用户组也会被删除

### 2. 查看用户信息

| 序号 |    命令     |            作用            |
| :--: | :---------: | :------------------------: |
|  01  | id [用户名] |  查看用户 UID 和 GID 信息  |
|  02  |     who     | 查看当前所有登录的用户列表 |
|  03  |   whoami    |  查看当前登录用户的账户名  |
|  04  |    exit     |        退出登录用户        |



**说明:**

- 如果是切换后的登陆用户，退出则返回上一个登陆账号。
- 如果是终端界面，退出当前终端。

**passwd 文件**

| 命令   | 说明                                             |
| :----- | :----------------------------------------------- |
| passwd | 修改用户密码，不指定用户默认修改当前登录用户密码 |

`/etc/passwd` 文件存放的是用户的信息，由 6 个分号组成的 7 个信息，分别是

1. 用户名
2. 密码（x，表示加密的密码）
3. UID（用户标识）
4. GID（组标识）
5. 用户全名或本地帐号
6. 家目录
7. 登录使用的 Shell，就是登录之后，使用的终端命令，`ubuntu` 默认是 `dash`



## 六、 usermod 命令说明

- `usermod` 可以用来设置 **用户** 的 **主组** ／ **附加组** 和 **登录 Shell**，命令格式如下：
- **主组**：通常在新建用户时指定，在 `etc/passwd` 的第 4 列 **GID 对应的组**
- **附加组**：在 `etc/group` 中最后一列表示该组的用户列表，用于指定 **用户的附加权限**

> 提示：设置了用户的附加组之后，需要重新登录才能生效！

```bash
# 修改用户的主组（passwd 中的 GID）
usermod -g 组 用户名

# 修改用户的附加组
usermod -G 组 用户名

# 修改用户登录 Shell
usermod -s /bin/bash 用户名
```

> 注意：默认使用 `useradd` 添加的用户是没有权限使用 `sudo` 以 `root` 身份执行命令的，可以使用以下命令，将用户添加到 `sudo` 附加组中

```bash
usermod -G sudo 用户名
```

## 七、which 命令说明

> 提示
>
> - `/etc/passwd` 是用于保存用户信息的文件
> - `/usr/bin/passwd` 是用于修改用户密码的程序

- `which` 命令可以查看执行命令所在位置，例如：

```bash
which ls

# 输出
# /bin/ls

which useradd

# 输出
# /usr/sbin/useradd
```

`bin` 和 `sbin`

- 在 `Linux` 中，绝大多数可执行文件都是保存在 `/bin`、`/sbin`、`/usr/bin`、`/usr/sbin`
- `/bin`（`binary`）是二进制执行文件目录，主要用于具体应用
- `/sbin`（`system binary`）是系统管理员专用的二进制代码存放目录，主要用于系统管理
- `/usr/bin`（`user commands for applications`）后期安装的一些软件
- `/usr/sbin`（`super user commands for applications`）超级用户的一些管理程序

> 提示：
>
> - `cd` 这个终端命令是内置在系统内核中的，没有独立的文件，因此用 `which` 无法找到 `cd` 命令的位置



## 八、切换用户命令说明

| 序号 |    命令     |          作用          |                   说明                   |
| :--: | :---------: | :--------------------: | :--------------------------------------: |
|  01  | su - 用户名 | 切换用户，并且切换目录 | - 可以切换到用户家目录，否则保持位置不变 |
|  02  |    exit     |    退出当前登录账户    |                                          |

- `su` 不接用户名，可以切换到 `root`，但是不推荐使用，因为不安全
- `exit` 示意图如下：



## 九、修改文件权限命令说明

| 序号 | 命令  |    作用    |
| :--: | :---: | :--------: |
|  01  | chown | 修改拥有者 |
|  02  | chgrp |   修改组   |
|  03  | chmod |  修改权限  |

- 命令格式如下：

```bash
# 修改文件|目录的拥有者
chown 用户名 文件名|目录名

# 递归修改文件|目录的组
chgrp -R 组名 文件名|目录名

# 递归修改文件权限
chmod -R 755 文件名|目录名
```

- `chmod` 在设置权限时，可以简单地使用三个数字分别对应 **拥有者** ／ **组** 和 **其他** 用户的权限

```bash
# 直接修改文件|目录的 读|写|执行 权限，但是不能精确到 拥有者|组|其他
chmod +/-rwx 文件名|目录名
```



常见数字组合有（`u`表示用户／`g`表示组／`o`表示其他）：

- `777` ===> `u=rwx,g=rwx,o=rwx`
- `755` ===> `u=rwx,g=rx,o=rx`
- `644` ===> `u=rw,g=r,o=r`

