# vi编辑器

## 一、学习 vi 的目的

在工作中，要对 **服务器** 上的文件进行 **简单** 的修改，可以使用 `ssh` 远程登录到服务器上，并且使用 `vi` 进行快速的编辑即可，学习vi的主要目标有以下几点：

1. **环境普遍性**：vi/vim几乎在所有的Unix和Linux系统中都预装了，所以当你远程登录到任何一个服务器时，你都可以使用vi来编辑文件。
2. **高效率**：vi/vim采用模式编辑（命令模式、插入模式、可视模式等），通过键盘快捷键来完成各种编辑操作，避免了频繁地移动手到鼠标上。一旦习惯了这种操作方式，你会发现它比使用鼠标要高效很多。
3. **强大的编辑功能**：vi/vim支持各种高级文本操作，包括正则表达式搜索和替换、多窗口、代码折叠、语法高亮等。
4. **定制性和扩展性**：vi/vim允许用户通过.vimrc文件来定制编辑器的行为，并且有丰富的插件可以进一步扩展编辑器的功能。
5. **程序员的必备技能**：对于系统管理员和开发者来说，vi/vim是一个必备的技能。在很多情况下，你可能需要在没有图形界面的服务器上编辑配置文件或脚本，这时候就需要用到vi/vim。

在没有图形界面的环境下，要编辑文件，`vi` 是最佳选择！

## 二、 vi 和 vim

vi和vim是两种常见的文本编辑器，主要在Unix和Linux系统中使用。

**vi**（Visual Interface）是一种交互式文本编辑器，最早在1976年的UNIX系统中出现。vi的设计目标是让用户在不离开键盘的情况下快速编辑文本。在vi中，可以用命令模式输入指令来完成复杂的文本操作，比如搜索和替换文本、跳转到指定行等。

**vim**（Vi IMproved）是vi编辑器的一个升级版，由Bram Moolenaar于1991年发布。相比于vi，vim增加了很多新功能，包括语法高亮、代码折叠、多窗口、多级撤销/重做、垂直分割窗口、插件系统等。Vim不仅兼容vi的所有命令，还增加了一些新的命令和快捷键。

## 三、打开和新建文件

在vi或vim中，打开或新建文件都是非常简单的。

### 1. 打开文件

要打开一个文件，你只需要在终端中输入`vi`（或`vim`）命令，后面接上你想打开的文件的路径。例如，如果你想打开名为`example.txt`的文件，你可以输入：

```bash
vi example.txt
```

或者

```bash
vim example.txt
```

这将打开`example.txt`文件（如果它存在的话）。如果这个文件不存在，vi或vim将打开一个新的、名为`example.txt`的空白文件。

### 2. 新建文件

要新建一个文件，只需要打开一个不存在的文件即可。例如，如果你想新建一个名为`newfile.txt`的文件，你可以输入：

```bash
vi newfile.txt
```

或者

```bash
vim newfile.txt
```

这将新建一个名为`newfile.txt`的空白文件。你可以在这个文件中输入内容，然后保存退出。

### 3. 打开文件并且定位行

如果你想在打开文件的同时定位到某一行，可以在vim命令后面添加`+行号`。例如，如果你想打开`example.txt`文件并且定位到第50行，可以使用以下命令：

```bash
vim +50 example.txt
```

如果你已经在vim中打开了文件，也可以使用以下命令跳转到特定行：

- 在命令模式下，输入行号，然后按`G`键。例如，输入`50G`会跳转到第50行。
- 在命令模式下，输入`:`，然后输入行号并按回车。例如，输入`:50`会跳转到第50行。

## 四、异常处理

在使用vim或vi编辑器时，你可能会遇到一些问题或异常。以下是一些常见的问题和相应的解决办法：

1. **文件已锁定或 "E325: ATTENTION" 错误**：当两个vim进程尝试编辑同一个文件时，你可能会看到这个错误。在这种情况下，你可以选择删除交换文件（在错误消息中会给出路径）或者使用`vim -r filename`命令来恢复文件。
2. **意外退出导致的未保存工作**：如果你的vim因为某种原因（比如电源断电或者SSH连接断开）意外退出，你可能会丢失未保存的工作。你可以使用`vim -r filename`命令来恢复未保存的工作。
3. **文本显示问题**：如果你打开的文件包含特殊字符，或者你的终端不支持文件的编码，你可能会看到乱码。在这种情况下，你可以尝试改变终端或vim的编码设置，或者使用`:set display=uhex`命令来查看特殊字符的Unicode编码。
4. **插件问题**：如果你安装了一些vim插件，它们可能会引入新的错误或者改变vim的行为。在这种情况下，你可以尝试禁用插件，或者查阅插件的文档以了解如何解决问题。

一般来说，遇到问题时，最好的办法是查阅vim的帮助文档（可以在vim中使用`:help`命令来打开），或者在网络上搜索错误消息。你也可以尝试在不同的环境（例如不同的终端或不同的操作系统）下运行vim，以了解问题是否与特定环境相关。

## 五、三种工作模式

在使用vi或vim时，你会遇到三种主要的工作模式：命令模式、插入模式和命令行模式。

1. **命令模式**：这是vim启动后的默认模式。在这个模式下，你可以输入各种命令来移动光标、复制和粘贴文本、搜索和替换文本等。例如，`h`、`j`、`k`、`l`键可以用来移动光标，`yy`可以复制一行，`dd`可以删除一行，`/`可以搜索文本等。
2. **插入模式**：在命令模式下，按下`i`键就可以进入插入模式。在这个模式下，你可以像在普通的文本编辑器中一样输入文本。在插入模式下，按`ESC`键可以回到命令模式。
3. **命令行模式**：在命令模式下，按下`:`键就可以进入命令行模式。在这个模式下，你可以输入一些特殊的命令，比如保存文件（`:w`），退出vim（`:q`），保存并退出（`:wq`），跳转到特定行（比如`:10`跳转到第10行）等。输入完命令后，按回车键可以执行命令。

除了这三种主要的工作模式，vim还支持一些其他模式，比如可视模式（用于选择文本块），选择模式（类似于其他文本编辑器的选择模式）等。但是对于初学者来说，理解并熟练使用命令模式、插入模式和命令行模式是最重要的。

## 六、常用命令

### 1. 移动（基本）

要熟练使用 `vi`，首先应该学会怎么在 **命令模式** 下样快速移动光标

#### 1.1 上、下、左、右

在vim的命令模式下，可以使用一系列的命令来移动光标。以下是一些基本的光标移动命令：

- `h`：光标向左移动一个字符。
- `j`：光标向下移动一行。
- `k`：光标向上移动一行。
- `l`：光标向右移动一个字符。

你也可以在这些命令前加上一个数字，来快速移动多个单位。例如，`10j`会使光标向下移动10行。

#### 1.2 行内移动

以下是一些常用的在行内移动的命令：

- `0`：移动到行首
- `$`：移动到行尾
- `^`：移动到该行第一个非空白字符
- `w`：移动到下一个单词的起始处
- `b`：移动到前一个单词的起始处
- `e`：移动到下一个单词的结束处
- `ge`：移动到前一个单词的结束处

#### 1.3 行数移动

以下是一些常用的在行间移动的命令：

- `j` 或者 `Enter`：向下移动一行
- `k`：向上移动一行
- `nG`：移动到第n行，n为数字
- `gg`：移动到文档的第一行
- `G`：移动到文档的最后一行

#### 1.4 屏幕移动

以下是一些常用的在屏幕间移动的命令：

- `H`：移动到屏幕的顶部（Home）
- `M`：移动到屏幕的中间（Middle）
- `L`：移动到屏幕的底部（Last）
- `Ctrl + f`：向前（下方）滚动一整屏（相当于Page Down）
- `Ctrl + b`：向后（上方）滚动一整屏（相当于Page Up）
- `Ctrl + u`：向后（上方）滚动半屏
- `Ctrl + d`：向前（下方）滚动半屏

在vim中，通过熟练使用这些命令，你可以非常高效地在文件中移动。

### 2. 移动（程序）

#### 2.1 段落移动

在处理文本文件时，可以使用以下命令：

- `{`：向上移动到上一个段落的开始（段落之间由一个或多个空行分隔）。
- `}`：向下移动到下一个段落的开始。

#### 2.2 括号切换

在编程时，可以使用以下命令：

- `%`：在配对的括号（`(`和`)`，`[`和`]`，`{`和`}`）或者 HTML/XML 标签之间跳转。

#### 2.3  标记

可以在文件中设置标记，并快速跳转到标记处：

- `mx`：在当前位置设置一个标记，x 可以是任何小写字母。
- `'x`：跳转到标记x所在的行的开始，x 是你之前设置的标记。
- `\`x：跳转到标记x所在的准确位置，x 是你之前设置的标记。

注意，以上所有的命令都应在命令模式下使用。

### 3.  选中文本（可视模式）

在 Vim 中，你可以使用可视模式来选中文本。以下是一些基本的可视模式命令：

- `v`：启动字符可视模式。在这个模式下，你可以移动光标来选中文本。你选中的是从你启动可视模式的位置到你当前光标位置之间的文本。
- `V`：启动行可视模式。在这个模式下，你可以移动光标来选中整行文本。你选中的是从你启动可视模式的那一行到你当前光标所在行之间的所有行。
- `Ctrl + v` 或 `^V`：启动列可视模式（也叫块可视模式）。在这个模式下，你可以移动光标来选中一个矩形区块的文本。

在可视模式下，你可以使用 Vim 的所有光标移动命令来选中文本。例如，`w` 可以选中下一个单词，`$` 可以选中到行尾的所有文本，`G` 可以选中到文档末尾的所有文本，等等。

一旦你选中了一些文本，你就可以对这些文本执行各种操作，比如复制（`y`）、粘贴（`p`）、删除（`d`）、更改（`c`）或者格式化（`=`）。你也可以输入 `:` 来进入命令行模式，并对选中的文本执行任何 Ex 命令。例如，`:s/foo/bar/g` 会把选中文本中的所有 "foo" 替换成 "bar"。

按下 `ESC` 键可以退出可视模式，并返回到命令模式。

### 4. 撤销和恢复撤销

在 Vim 中，撤销和恢复撤销的操作也非常简单：

**撤销：**

在命令模式下，你只需要按 `u` 键即可撤销最后的修改。如果你连续按多次 `u` 键，Vim 将会撤销更多的修改。

**恢复撤销：**

如果你撤销了一些修改，然后又改变主意想要恢复它们，你可以使用 `Ctrl + r` 键。这个命令会恢复你最近撤销的修改。如果你连续按多次 `Ctrl + r`，Vim 将会恢复更多之前撤销的修改。

注意，Vim 的撤销历史是有深度的，这意味着你可以撤销很久之前的修改，然后再恢复它们。但是，一旦你退出 Vim，你就无法恢复那个 Vim 会话中的撤销历史了。如果你想要在 Vim 会话之间保持撤销历史，你需要在你的 vimrc 文件中设置 'undofile' 选项。

### 5. 删除文本

在Vim中，你可以使用一系列命令在命令模式下删除文本。以下是一些常用的删除命令：

- `x`：删除光标下的字符。
- `X`：删除光标前的字符。
- `d`：与一个移动命令结合使用，可以删除从光标当前位置到移动命令目标位置之间的文本。例如，`dw`会删除从光标位置到下一个单词开头的文本，`d$`会删除从光标位置到行尾的文本。
- `dd`：删除整行。
- `D`：删除从光标位置到行尾的文本。
- `:delete` 或 `:d`：在命令行模式下删除一行或多行。可以与行范围结合使用，如 `:1,3d` 会删除第1行到第3行。

所有的删除命令都会将删除的文本放入剪贴板，因此你可以使用 `p` 或 `P` 命令将其粘贴回来。在Vim中，你可以撤销删除操作（使用 `u` 命令）或重做被撤销的删除操作（使用 `Ctrl + r` 命令）。

注意，这些命令都应在命令模式下使用。在插入模式或命令行模式下，这些键的行为会不同。

### 6. 复制、粘贴

在 Vim 中，你可以在命令模式下使用以下命令来复制和粘贴文本：

**复制：**

- `yy` 或 `Y`：复制当前行。
- `2yy`：复制两行。可以将 2 替换为任何数字，以复制该数量的行。
- `yw`：复制一个单词。
- `y$`：复制到行尾的内容。
- `y0`：复制到行头的内容。
- `yiw`：复制当前光标下的单词（不包括周围的空格）。
- `yaw`：复制当前光标下的单词（包括一个周围的空格）。

这里的 `y` 是 "yank" 的意思，这是 Vim 中的术语，意味着 "复制"。

**粘贴：**

- `p`：在光标之后粘贴。
- `P`：在光标之前粘贴。

粘贴的内容是从 Vim 的寄存器中获取的。默认情况下，复制和删除操作都会将文本放入 unnamed 寄存器中。你也可以在复制或删除前指定一个寄存器（例如，`"ayw` 会将一个单词复制到寄存器 a 中），然后在粘贴时使用该寄存器（例如，`"ap` 会粘贴寄存器 a 中的内容）。在 Vim 中有多个寄存器，可以用来存储不同的文本片段。

### 7.  替换

在 Vim 中，你可以使用多种方法来替换文本：

**单字符替换：**

- `r`: 替换当前光标下的一个字符。在命令模式下，按下 `r` 键后再按下你想要替换的字符即可。例如，如果光标正在一个 `a` 字符上，你可以按 `rb` 来将其替换为 `b`。

**单词替换：**

- `cw`: 替换一个单词。在命令模式下，将光标移动到一个单词上，然后输入 `cw`，然后输入新的单词，然后按 `Esc` 返回到命令模式。这个命令会将光标所在的单词替换为你输入的新单词。

**行替换：**

- `cc`: 替换整行。在命令模式下，将光标移动到想要替换的行上，然后输入 `cc`，然后输入新的行，然后按 `Esc` 返回到命令模式。这个命令会将光标所在的行替换为你输入的新行。

**全文替换：**

- `:%s/old/new/g`: 这是一个 Ex 命令，可以在命令行模式下使用。它会将文件中所有的 "old" 替换为 "new"。这个命令的格式是 `:%s/pattern/replacement/flags`。`%` 是一个范围，表示整个文件。`s` 是 "substitute"（替换）的意思。`pattern` 是你想要替换的文本，`replacement` 是你想要替换为的文本。`g` 是一个标志，表示 "global"（全局），意味着替换每一行中的所有匹配项，而不仅仅是每一行的第一个匹配项。

### 8. 缩排和重复执行

**缩进：**

Vim 提供了多种命令来增加或减少缩进：

- `>>`：增加当前行的缩进。
- `<<`：减少当前行的缩进。
- `>` 和 `<`：当这两个命令在可视模式中使用时（你可以按 `v` 进入可视模式并选择多行），它们可以增加或减少选中行的缩进。
- `==`：自动调整当前行的缩进。

**重复执行：**

Vim 的 "`.`" 命令可以重复上次的修改命令。例如，如果你刚刚输入了 `2dd` 来删除两行，那么你可以按 `.` 来再删除两行。

在 Vim 中，"修改命令" 是一个广义的概念，它包括插入文本、删除文本、替换文本、改变文本和格式化文本等操作。

对于一些命令，如缩进命令，你可以在命令前加一个数字来指定重复的次数。例如，`4>>` 会增加当前行的缩进 4 次，`3. `会重复上次的修改命令 3 次。

你还可以使用 Vim 的宏功能来录制一系列的命令，然后再次执行它们。要录制一个宏，你可以按 `q` 键，然后按一个字母键来指定宏的名字，然后输入你想要录制的命令，最后再按 `q` 来结束录制。你可以通过按 `@` 键然后按宏的名字来执行一个宏。你还可以在 `@` 前加一个数字来指定重复的次数。

### 9.  查找

在 Vim 中，查找文本非常方便。以下是一些常见的查找命令：

**在行内查找：**

- `f{char}`：在当前行中向前查找字符 {char}，光标移动到找到的字符上。
- `F{char}`：在当前行中向后查找字符 {char}，光标移动到找到的字符上。
- `t{char}`：在当前行中向前查找字符 {char}，光标移动到找到的字符前一位。
- `T{char}`：在当前行中向后查找字符 {char}，光标移动到找到的字符后一位。
- `;`：重复上一次的 `f`, `F`, `t`, `T` 命令。
- `,`：反向重复上一次的 `f`, `F`, `t`, `T` 命令。

**在整个文件中查找：**

- `/pattern`：向前查找匹配 pattern 的文本。pattern 可以是一个正则表达式。
- `?pattern`：向后查找匹配 pattern 的文本。pattern 可以是一个正则表达式。
- `n`：重复上一次的 `/` 或 `?` 命令。
- `N`：反向重复上一次的 `/` 或 `?` 命令。

在 Vim 中，你可以使用 `*` 命令来查找光标下的单词。`*` 会向前查找，而 `#` 会向后查找。

你还可以在 Vim 的命令行模式中使用 `:g` 和 `:v` 命令来查找匹配或不匹配特定模式的行。例如，`:g/foo/` 会列出所有包含 "foo" 的行，而 `:v/bar/` 会列出所有不包含 "bar" 的行。

这些命令都在命令模式下使用。

### 10. 插入命令

在 Vim 中，插入命令用于切换到插入模式，从而可以输入文本。以下是一些常见的插入命令：

- `i`：在当前光标位置前插入。
- `I`：在当前行首插入。
- `a`：在当前光标位置后插入。
- `A`：在当前行尾插入。
- `o`：在当前行下方打开一行并插入。
- `O`：在当前行上方打开一行并插入。
- `s`：删除当前光标位置的字符，并插入。
- `S`：删除当前行，并插入。

每个命令都会将 Vim 切换到插入模式，你可以开始输入文本。要退出插入模式并返回到命令模式，你可以按 `Esc` 键或 `Ctrl + [`。在插入模式下，大多数键都会插入相应的字符，而不会执行命令。然而，有一些键仍然会执行特殊的命令，例如 `Tab` 会插入一个制表符，`Enter` 会插入一个新行，`Backspace` 会删除前一个字符，等等。

在 Vim 的插入模式中，你还可以使用 `Ctrl + h` 删除前一个字符，使用 `Ctrl + w` 删除前一个单词，使用 `Ctrl + u` 删除至行首，这些都是在没有 `Backspace` 键的老式键盘上使用的命令。

### 11. 分屏命令

在 Vim 中，你可以使用一些命令来分割窗口，这样就可以在一个屏幕上查看和编辑多个文件或多个文件的不同部分。以下是一些常用的分屏命令：

**垂直分屏：**

- `:vsplit` 或 `:vs`：这个命令会垂直分割当前窗口。你会得到两个宽度相等的窗口，每个窗口都显示当前文件的同一部分。你也可以在 `:vsplit` 后面加一个文件名，来在新窗口中打开一个不同的文件。
- `Ctrl-w v`：这是一个普通模式的命令，它也会垂直分割当前窗口。

**水平分屏：**

- `:split` 或 `:sp`：这个命令会水平分割当前窗口。你会得到两个高度相等的窗口，每个窗口都显示当前文件的同一部分。你也可以在 `:split` 后面加一个文件名，来在新窗口中打开一个不同的文件。
- `Ctrl-w s`：这是一个普通模式的命令，它也会水平分割当前窗口。

**在窗口之间切换：**

- `Ctrl-w h/j/k/l`：这些命令会让你在窗口之间移动。`h` 会移动到左边的窗口，`l` 会移动到右边的窗口，`j` 会移动到下面的窗口，`k` 会移动到上面的窗口。这与 Vim 的普通模式下的移动命令相对应。
- `Ctrl-w w`：这个命令会在窗口之间循环切换。

在 Vim 中，每个窗口都有自己的光标位置和视图，你可以在每个窗口中独立地滚动和编辑。当你切换到一个新的窗口时，你的命令和输入都会应用到新窗口的文件上。



